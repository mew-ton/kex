# Composition (Multiple Roots)

Kex supports aggregating documentation from multiple sources (roots) into a single unified index. This is useful for:
- Mixing local project-specific guidelines with shared organization-wide guidelines.
- Combining multiple repositories (e.g., a "monorepo" setup).
- Including remote guidelines (via URL) alongside local files.

## Configuration
 
 In `.kex.yaml`, the `source` key defines the content location for that specific project root. It accepts a single string.
 
 ```yaml
 # .kex.yaml
 source: contents
 ```
 
 To verify or serve multiple roots together, you must verify them using the CLI arguments.

## Command Line Usage
 
 You can also specify multiple roots via the CLI by passing them as positional arguments:
 
 ```bash
 kex start . ./extra-docs
 # or
 kex check . https://shared.example.com/
 ```
 
 ## Resolution Logic

When you provide a path to the CLI, Kex inspects the directory contents to determine how to treat it.

### 1. Project Root (`.kex.yaml`)

If the path contains a `.kex.yaml` configuration file, Kex identifies it as a **Project Root**.
- It loads the configuration.
- It resolves the content source path defined in the `source` key (defaulting to `contents`).

### 2. Pre-Indexed Root (`kex.json`)

If the path does not have a config but contains a `kex.json`, Kex identifies it as a **Pre-Indexed Root**.
- `kex.json` is an index file generated by the `kex generate` command to enable static access to documentation.
- When this file is present (or served by a URL), Kex uses it directly as the source of truth, skipping local markdown parsing.

### 3. Content Source (Ad-Hoc)

If **no manifest** (`.kex.yaml` or `kex.json`) is found:
- The path is treated directly as a **Content Source**.
- Kex scans the directory for markdown files. This is useful for ad-hoc checks or quick starts without any configuration.

## ID Collision Policy: Strict Uniqueness

When composing multiple sources, Kex enforces a **Strict Uniqueness** policy for Document IDs.

**The Rule**:
> **A Document ID must be unique across ALL loaded roots.**

If the same ID (e.g., `CODING_STYLE`) is found in multiple places (e.g., both in your local project and the remote shared guidelines), Kex will **fail to start (or check)** and report an error.

### Why?

- **No Ambiguity**: You always know exactly which guideline is active.
- **Safety**: Prevents accidental shadowing where a local file silently overrides a critical compliance rule from a remote source.

### Resolution

If you encounter an ID collision, you must explicitly resolve it:
1. **Remove** the duplicate document from one of the sources.
2. **Rename** the ID in one of the documents if they are indeed covering different topics.
