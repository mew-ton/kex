# コンポジション（複数のルートディレクトリサポート）

Kex は、複数のソース（ルート）からのドキュメントを集約し、単一のインデックスとして扱うことができます。これは以下のようなケースで役立ちます：

- プロジェクト固有のガイドラインと、組織全体で共有されるガイドラインを組み合わせる。
- 複数のリポジトリを統合する（例：モノレポ構成）。
- ローカルファイルとリモートのガイドライン（URL経由）を混在させる。

## 設定方法

`.kex.yaml` 内の `source` キーは、そのプロジェクトルートのコンテンツ配置場所を定義します。これは単一の文字列である必要があります。
 
 ```yaml
 # .kex.yaml
 source: contents
 ```
 
 複数のルートを統合して検証・サーブする場合は、CLI 引数を使用する必要があります。

## コマンドラインでの使用

CLI を介して複数のルートを指定することも可能です。複数のパスを位置引数として渡します：

```bash
kex start . ./extra-docs
# または
kex check . https://shared.example.com/
```

## 解決ロジック (Resolution Logic)
 
 CLI にパスを提供すると、Kex はディレクトリの内容を検査して、そのパスの扱いを以下のように決定します。
 
 ### 1. プロジェクトルート (`.kex.yaml`)
 
 パス内に `.kex.yaml` 設定ファイルが含まれている場合、Kex はそれを **プロジェクトルート** として識別します。
 - 設定ファイルを読み込みます。
 - `source` キーで定義されたコンテンツソースのパスを解決します（デフォルトは `contents`）。
 
 ### 2. プリインデックスルート (`kex.json`)
 
 設定ファイルがなく、代わりに `kex.json` が含まれている場合、Kex はそれを **プリインデックスルート** として識別します。
 - `kex.json` は、ドキュメントへの静的なアクセスを実現するために `kex generate` コマンドによって生成されるインデックスファイルです。
 - このファイルが存在する場合（または URL がこのファイルを提供する場合）、Kex はローカルのマークダウン解析をスキップし、このファイルを信頼できる情報源（Source of Truth）として直接使用します。
 
 ### 3. コンテンツソース (アドホック)
 
 **マニフェスト** (`.kex.yaml` または `kex.json`) が見つからない場合：
 - そのパスは直接 **コンテンツソース** として扱われます。
 - Kex はそのディレクトリ内のマークダウンファイルをスキャンします。これは、設定なしで手軽にドキュメントをチェックしたり閲覧したりしたりする場合に便利です。

## ID 衝突ポリシー：厳格な一意性 (Strict Uniqueness)

複数のソースを合成する場合、Kex はドキュメントIDに対して **厳格な一意性（Strict Uniqueness）** ポリシーを適用します。

**ルール**:
> **ドキュメントIDは、読み込まれたすべてのルート全体で一意でなければなりません。**

もし同じID（例：`CODING_STYLE`）が複数の場所（例：ローカルプロジェクトとリモートの共有ガイドラインの両方）で見つかった場合、Kex は **起動（またはチェック）に失敗** し、エラーを報告します。

### 理由

- **曖昧さの排除**: どのガイドラインが適用されているかを常に明確にするためです。
- **安全性**: ローカルファイルが、リモートソースの重要なコンプライアンスルールを知らないうちに上書きしてしまう事故を防ぎます。

### 解決策

IDの衝突が発生した場合、明示的に解決する必要があります：
1. いずれかのソースから重複するドキュメントを **削除** する。
2. もしそれらが異なるトピックを扱っている場合は、ドキュメントの ID を **リネーム** する。
